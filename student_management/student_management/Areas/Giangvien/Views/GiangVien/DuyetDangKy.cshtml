@model IEnumerable<student_management.Models.DangKyHoc>
@{
    ViewData["Title"] = "Duyệt sinh viên đăng ký";
}

<h2 class="text-primary mb-4">🧾 Danh sách sinh viên chờ duyệt</h2>

@if (!Model.Any())
{
    <div class="alert alert-info">
        Không có sinh viên nào đang chờ duyệt trong lớp này.
    </div>
}
else
{
    <table class="table table-bordered table-striped align-middle">
        <thead class="table-light">
            <tr>
                <th>Mã SV</th>
                <th>Họ tên</th>
                <th>Ngày đăng ký</th>
                <th>Trạng thái</th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var dk in Model)
            {
                <tr id="row-@dk.MaSv">
                    <td>@dk.MaSv</td>
                    <td>@dk.MaSvNavigation.HoTen</td>
                    <td>@dk.NgayDangKy.ToString("dd/MM/yyyy HH:mm")</td>
                    <td>
                        <span class="badge bg-warning text-dark">@dk.TrangThai</span>
                    </td>
                    <td>
                        <button class="btn btn-success btn-sm" onclick="duyetSV('@dk.MaSv')">
                            ✅ Duyệt
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<a href="@Url.Action("DanhSachSinhVien", "GiangVien", new { area = "GiangVien", maLHP = ViewBag.MaLHP })"
   class="btn btn-secondary mt-3">⬅️ Quay lại danh sách lớp</a>

@section Scripts {
    <script>
        function duyetSV(maSV) {
            if (!confirm("Bạn có chắc muốn duyệt sinh viên " + maSV + " không?")) return;

            $.ajax({
                url: '@Url.Action("XacNhanDuyet", "GiangVien", new { area = "GiangVien" })',
                type: 'POST',
                data: {
                    maLHP: '@ViewBag.MaLHP',
                    maSV: maSV
                },
                success: function (res) {
                    if (res.success) {
                        alert(res.message);
                        $("#row-" + maSV).fadeOut(); // ẩn dòng đã duyệt
                    } else {
                        alert("❌ " + res.message);
                    }
                },
                error: function () {
                    alert("Lỗi kết nối đến server!");
                }
            });
        }
    </script>
}
